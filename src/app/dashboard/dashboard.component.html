<div class="first-div">
  <!--  <button mat-raised-button color="primary" class="btn btn-primary" (click)="latestPull($event)">Reload</button>-->
  <button type="button" class="btn btn-secondary ml3" (click)="latestPull($event)"><i class="fas fa-sync-alt fa-fw"></i> Reload in <span class="timer">{{timer}}</span></button>
  <button type="button" *ngIf="isAdmin" class="btn btn-primary ml3" (click)="AddHost()"><i class="fas fa-plus fa-fw"></i> Add Host</button>
  <button type="button" class="btn btn-primary ml3">
    <i class="fas fa-sync-alt fa-fw"></i> Reload 60s&nbsp;
    <mat-slide-toggle [(ngModel)]="isChecked" name="check" (change)="autoReload($event)"></mat-slide-toggle>
  </button>
  <button type="button" class="btn btn-danger float-end mr-2" (click)="logout()"><i class="fas fa-sign-out-alt fa-fw"></i> Logout</button>

  <button type="button" *ngIf="isAdmin" class="btn btn-primary ml3" (click)="showInternetStatus()"><i class="fab fa-internet-explorer"></i>&nbsp;&nbsp;
    <mat-slide-toggle [(ngModel)]="this.intChecked" name="check" (change)="internetCheck($event)"></mat-slide-toggle>
  </button>
  <button type="button" *ngIf="isAdmin" class="btn btn-primary ml3 dropdown-toggle" id="dropdownInternetCheck" data-bs-toggle="dropdown" aria-expanded="false">
    <i class="fas fa-chart-area"></i>
  </button>
  <ul class="dropdown-menu" aria-labelledby="dropdownInternetCheck">
    <li><a class="dropdown-item" (click)="internetChartGet(24)">2H Metrics</a></li>
    <li><a class="dropdown-item" (click)="internetChartGet(48)">4H Metrics</a></li>
    <li><a class="dropdown-item" (click)="internetChartGet(96)">8H Metrics</a></li>
    <li><a class="dropdown-item" (click)="internetChartGet(144)">12H Metrics</a></li>
    <li><a class="dropdown-item" (click)="internetChartGet(288)">24H Metrics</a></li>
    <li><a class="dropdown-item" (click)="internetChartGet(576)">48H Metrics</a></li>
    <li><a class="dropdown-item" (click)="internetChartGet(2016)" *ngIf="isAdmin">Full Metrics <i class="fas fa-exclamation-circle"></i></a></li>
  </ul>
</div>


<div id="internetStatusId" style="text-align: center">
  <div id="internetStatus" style="height:500px;">
    <div style="text-align: center" id="iSpinner" class="spinner-border" role="status">
      <span style="text-align: center" class="sr-only"></span>
    </div>
  </div>
</div>

<div style="text-align: center">
  <div *ngIf="this.loading" style="text-align: center" id="mSpinner" class="spinner-border" role="status">
    <span style="text-align: center" class="sr-only"></span>
  </div>
</div>



<div class="card">
  <p-table #dt [value]="responseData" [rows]="10" [paginator]="true" [globalFilterFields]="['hostName','ipAddress','status','groupName','clusterName','envName','vmName','note']"
  selectionMode="multiple" [(selection)]="selectedHosts" [metaKeySelection]="true" [rowHover]="true" dataKey="_id"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries" [showCurrentPageReport]="true">
      <ng-template pTemplate="caption">
          <div class="p-d-flex p-ai-center p-jc-between">
              <!-- <h5 class="p-m-0">Manage Products</h5> -->
              <span class="p-input-icon-left">
                  <i class="pi pi-search"></i>
                  <input pInputText type="text" (input)="dt.filterGlobal($any($event.target).value, 'contains')" placeholder="Search..." />
              </span>
          </div>
      </ng-template>
      <ng-template pTemplate="header">
          <tr>
              <th style="width: 3rem">
                  <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
              </th>
              <th pSortableColumn="hostName ">Host Name <p-sortIcon field="hostName"></p-sortIcon></th>
              <th pSortableColumn="ipAddress">Address <p-sortIcon field="ipAddress"></p-sortIcon></th>
              <th></th>
          </tr>
      </ng-template>
      <ng-template pTemplate="body" let-host let-rowIndex="rowIndex">
          <tr [pSelectableRow]="host" [pSelectableRowIndex]="rowIndex">
              <td>
                  <p-tableCheckbox [value]="host"></p-tableCheckbox>
              </td>
              <td>{{host.hostName}}</td>
              <td>{{host.ipAddress}}</td>
          </tr>
      </ng-template>
      <ng-template pTemplate="summary">
          <div class="p-d-flex p-ai-center p-jc-between">
              In total there are {{responseData ? responseData.length : 0 }} products.
          </div>
      </ng-template>
  </p-table>
</div>










<!-- Services Modal -->
<div class="modal fade" id="serviceModal" tabindex="-1" role="dialog" aria-labelledby="serviceModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div *ngIf="selectedService" class="modal-content">
      <div class="modal-header text-center">
        <h1 class="modal-title mb-0 bold w-100" id="hostStatusModalLabel">Services Status<br> </h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
        </button>
      </div>
      <div>
        <!-- <button type="button" class="btn btn-secondary ml3 float-left" (click)="latestPull($event)"><i class="fas fa-sync-alt fa-fw"></i> Reload in <span class="timer">{{timer}}</span></button>
        <button type="button" class="btn btn-primary ml3 float-left">
          <mat-slide-toggle [(ngModel)]="isChecked" name="check" (change)="autoReload($event)"><i class="fas fa-sync-alt fa-fw"></i> Auto Reload 60/s: {{isChecked}}</mat-slide-toggle>
        </button> -->
        <h3 class="text-center">{{ selectedService.hostName }} / {{ selectedService.ipAddress }}</h3>
      </div>
      <div class="modal-body p-1">
        <table class="table table-striped table-hover text-center">
          <thead>
            <tr class="text-light bg-dark">
              <th scope="col">#</th>
              <th scope="col">Service Name</th>
              <th scope="col">Port</th>
              <th scope="col">Status</th>
              <th scope="col">Http</th>
              <th scope="col">Path</th>
              <th scope="col">Method</th>
              <th scope="col">Code</th>
            </tr>
          </thead>
          <tbody>
              <tr *ngFor="let data of selectedService.port ; let i = index">
                <td>{{i + 1}}</td>
                <td>{{data.name}}</td>
                <td>{{data.port}}</td>
                <td>
                  <div class="nowrap">
                    <span *ngIf="data.status === EStatus.UP" class="badge bg-success ml-1">
                      <i class="fas fa-angle-double-up fa-fw"></i>
                    </span>
                    <span *ngIf="data.status === EStatus.DOWN" class="badge bg-danger ml-1">
                      <i class="fas fa-angle-double-down fa-fw"></i>
                    </span>
                  </div>
                </td>
                <td>
                  <mat-slide-toggle [(ngModel)]="data.http" name="port_{{i}}"></mat-slide-toggle>
                </td>
                <td>{{data.path}}</td>
                <td>{{data.method}}</td>
                <td>{{data.statuscode}}</td>
              </tr>
          </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


<!-- link modal -->
<div class="modal fade" id="linkModal" tabindex="-1" role="dialog" aria-labelledby="linkModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div *ngIf="selectedService" class="modal-content">
      <div class="modal-header text-center">
        <h1 class="modal-title mb-0 bold w-100" id="hostStatusModalLabel">Linked Hosts<br> </h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
        </button>
      </div>
      <div>
        <h3 class="modal-title mb-0 bold w-100 text-center" id="hostStatusModalLabel">{{ selectedService.hostName }} / {{ selectedService.ipAddress }}</h3>
      </div>
      <div class="modal-body p-1">
        <table class="table table-striped table-hover text-center">
          <thead>
            <tr class="text-light bg-dark">
              <th scope="col">#</th>
              <th scope="col">Host Name</th>
              <th scope="col">Address</th>
              <th scope="col">Port</th>
            </tr>
          </thead>
          <tbody>
              <tr *ngFor="let data of selectedService.linkTo ; let i = index">
                <td>{{i + 1}}</td>
                <td>{{data.hostName}}</td>
                <td>{{data.ipAddress}}</td>
                <td>{{data.port}}</td>
              </tr>
          </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Host Metrics Modal -->
<div class="modal fade" id="hostStatus" tabindex="-1" role="dialog" aria-labelledby="hostStatusModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-md" role="document">
    <div *ngIf="selectedService" class="modal-content">
      <div class="modal-header text-center">
        <h1 class="modal-title mb-0 bold w-100" id="hostStatusModalLabel">Host Metrics Status<br> </h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
        </button>
      </div>
      <div>
        <h3 class="modal-title mb-0 bold w-100 text-center" id="hostStatusModalLabel">{{ selectedService.hostName }} / {{ selectedService.ipAddress }}</h3>
      </div>
      <div class="modal-body p-1">
        <table class="table table-striped table-hover text-center">
          <thead>
            <tr class="text-light bg-dark">
              <th scope="col">#</th>
              <th scope="col">Disk Free in GB</th>
              <th scope="col">Memory Free in GB</th>
              <th scope="col">CPU Usage in %</th>
            </tr>
          </thead>
          <tbody>
              <tr *ngFor="let data of selectedService.hostMetrics ; let i = index">
                <td>{{i + 1}}</td>
                <td *ngIf="data.DiskFree <= 5" class="table-danger">{{data.DiskFree}}</td>
                <td *ngIf="data.DiskFree > 5" class="table-success">{{data.DiskFree}}</td>

                <td *ngIf="data.MemFree <= 0.1" class="table-danger">{{data.MemFree}}</td>
                <td *ngIf="data.MemFree > 0.1" class="table-success">{{data.MemFree}}</td>

                <td *ngIf="(data.DiskFree === 0 && data.MemFree === 0 && data.CpuUsage === 0) || (data.DiskFree > 0 && data.CpuUsage >= 90)" class="table-danger">{{data.CpuUsage}}</td>
                <td *ngIf="data.DiskFree > 0 && data.CpuUsage < 90" class="table-success">{{data.CpuUsage}}</td>
              </tr>
          </tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

